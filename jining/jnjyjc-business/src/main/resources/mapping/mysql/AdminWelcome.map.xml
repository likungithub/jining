<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须和接口名称一一对应 -->
<mapper namespace="com.xinhai.caiyun.dao.AdminWelcomeMapper">


	<!--启动统计-->
	<select id="qdtj" resultType="java.util.Map">
		<if test="cxtj.bz==0">
			SELECT '今天' AS ssj, pd.DAY_SHORT_DESC AS sj,(IFNULL(COUNT(DISTINCT a.SJXLH),0)) AS qdyhs,IFNULL(SUM(a.QDCS),0) qdcs,IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/SUM(a.QDCS)),'%H:%i:%S'),0) mcsysc, IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/COUNT(DISTINCT a.SJXLH)),'%H:%i:%S'),'0') AS mrsysc,IFNULL(ROUND(SUM(a.QDCS)/(COUNT(DISTINCT a.SJXLH)),2),0) AS rjqdcs FROM pt_date pd LEFT JOIN pt_app_qdtj a ON pd.DAY_SHORT_DESC=DATE_FORMAT(a.KSSJ,'%Y-%m-%d') WHERE  pd.DAY_SHORT_DESC=DATE_FORMAT(DATE_SUB(NOW(),INTERVAL 0 DAY),'%Y-%m-%d')
			<if test="cxtj.sjlx!=null">
				AND a.sjlx=#{cxtj.sjlx}
			</if>
			UNION ALL
			SELECT '昨天' AS ssj, pd.DAY_SHORT_DESC AS sj,(IFNULL(COUNT(DISTINCT a.SJXLH),0)) AS qdyhs,IFNULL(SUM(a.QDCS),0) qdcs,IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/SUM(a.QDCS)),'%H:%i:%S'),0) mcsysc, IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/COUNT(DISTINCT a.SJXLH)),'%H:%i:%S'),'0') AS mrsysc,IFNULL(ROUND(SUM(a.QDCS)/(COUNT(DISTINCT a.SJXLH)),2),0) AS rjqdcs FROM pt_date pd LEFT JOIN pt_app_qdtj a ON pd.DAY_SHORT_DESC=DATE_FORMAT(a.KSSJ,'%Y-%m-%d') WHERE  pd.DAY_SHORT_DESC=DATE_FORMAT(DATE_SUB(NOW(),INTERVAL 1 DAY),'%Y-%m-%d')
			<if test="cxtj.sjlx!=null">
				AND a.sjlx=#{cxtj.sjlx}
			</if>
			UNION ALL
			SELECT '汇总' AS ssj, pd.DAY_SHORT_DESC AS sj,(IFNULL(COUNT(DISTINCT a.SJXLH),0)) AS qdyhs,IFNULL(SUM(a.QDCS),0) qdcs,IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/SUM(a.QDCS)),'%H:%i:%S'),0) mcsysc, IFNULL(DATE_FORMAT(SEC_TO_TIME(SUM((TIME_TO_SEC(a.JSSJ)-TIME_TO_SEC(a.KSSJ)))/COUNT(DISTINCT a.SJXLH)),'%H:%i:%S'),'0') AS mrsysc,IFNULL(ROUND(SUM(a.QDCS)/(COUNT(DISTINCT a.SJXLH)),2),0) AS rjqdcs FROM pt_date pd LEFT JOIN pt_app_qdtj a ON pd.DAY_SHORT_DESC=DATE_FORMAT(a.KSSJ,'%Y-%m-%d') WHERE 1=1
			<if test="cxtj.sjlx!=null">
			AND a.sjlx=#{cxtj.sjlx}
		    </if>

		</if>
	</select>

	<!--新增客户 -->
	<select id="findKhtj" resultType="com.xinhai.caiyun.bean.PtKhtj" parameterType="java.lang.String">
		      <!--
				  *             01 代理员工
				  *             02 代理客户
				  *             03 代理潜在客户
				  *             04 新增代理记账公司
				  *             05 初审代理记账公司
				  *             06 终审代理记账公司
		      -->
              <if test=' tjlx == "01" '>
		      <![CDATA[
					SELECT '今日' LXMC,COUNT(ID) TJ  FROM USER  WHERE TO_DAYS(CREATE_DATE)=TO_DAYS(NOW()) AND  IS_DELETE='0'
					UNION ALL
					SELECT '昨日' LXMC,COUNT(ID) TJ FROM USER WHERE TO_DAYS( NOW( ) ) - TO_DAYS(CREATE_DATE) <= 1 AND  IS_DELETE='0'
					UNION ALL
					SELECT '近7天' LXMC,COUNT(ID) TJ FROM USER WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(CREATE_DATE) AND  IS_DELETE='0'
					UNION ALL
					SELECT '近30天' LXMC,COUNT(ID) TJ FROM USER WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(CREATE_DATE) AND  IS_DELETE='0'
					UNION ALL
					SELECT '今日' LXMC,COUNT(ID) TJ FROM USER WHERE DATE_FORMAT(CREATE_DATE,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m') AND  IS_DELETE='0'
					UNION ALL
					SELECT '上月' LXMC,COUNT(ID) TJ FROM USER WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(CREATE_DATE,'%Y%m'))=1 AND  IS_DELETE='0'
					UNION ALL
					SELECT '汇总' LXMC,COUNT(ID) TJ FROM USER WHERE  IS_DELETE='0'
               ]]>
			</if>
		<if test=' tjlx == "02" '>
			<![CDATA[
		            SELECT '今日' LXMC,COUNT(KHBM)  TJ  FROM PT_KHXX WHERE TO_DAYS(LRRQ)=TO_DAYS(NOW())  AND SCBZ='0'
					UNION ALL
					SELECT '昨日' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE TO_DAYS( NOW( ) ) - TO_DAYS(LRRQ) <= 1 AND SCBZ='0'
					UNION ALL
					SELECT '近7天' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(LRRQ) AND SCBZ='0'
					UNION ALL
					SELECT '近30天' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(LRRQ) AND SCBZ='0'
					UNION ALL
					SELECT '本月' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE DATE_FORMAT(LRRQ,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m') AND SCBZ='0'
					UNION ALL
					SELECT '上月' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(LRRQ,'%Y%m'))=1 AND SCBZ='0'
					UNION ALL
					SELECT '汇总' LXMC,COUNT(KHBM) TJ FROM PT_KHXX WHERE SCBZ='0'
               ]]>
		</if>

		<if test=' tjlx == "03" '>
			<![CDATA[
					SELEcT '今日' LXMC,COUNT(DLZH)  TJ  FROM PT_APP_KHXX WHERE TO_DAYS(ZCRQ)=TO_DAYS(NOW())  AND SCBZ='0'
					UNION ALL
					SELECT '昨日' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE TO_DAYS( NOW( ) ) - TO_DAYS(ZCRQ) <= 1  AND SCBZ='0'
					UNION ALL
					SELECT '近7天' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(ZCRQ)  AND SCBZ='0'
					UNION ALL
					SELECT '近30天' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(ZCRQ)  AND SCBZ='0'
					UNION ALL
					SELECT '本月' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE DATE_FORMAT(ZCRQ,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')  AND SCBZ='0'
					UNION ALL
					SELECT '上月' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(ZCRQ,'%Y%m'))=1  AND SCBZ='0'
					UNION ALL
					SELECT '汇总' LXMC,COUNT(DLZH) TJ FROM PT_APP_KHXX WHERE SCBZ='0'
			]]>
		</if>
		<if test=' tjlx == "04" '>
			<![CDATA[
				SELECT '今日' LXMC,COUNT(ID) TJ  FROM CUSTOMER  WHERE TO_DAYS(CREATE_DATE)=TO_DAYS(NOW()) AND SCBZ='0'
				UNION ALL
				SELECT '昨日' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE TO_DAYS( NOW( ) ) - TO_DAYS(CREATE_DATE) <= 1 AND SCBZ='0'
				UNION ALL
				SELECT '近7天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(CREATE_DATE) AND SCBZ='0'
				UNION ALL
				SELECT '近30天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(CREATE_DATE) AND SCBZ='0'
				UNION ALL
				SELECT '本月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_FORMAT(CREATE_DATE,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m') AND SCBZ='0'
				UNION ALL
				SELECT '上月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(CREATE_DATE,'%Y%m'))=1 AND SCBZ='0'
				UNION ALL
				SELECT '汇总' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE SCBZ='0'
			]]>
		</if>
		<if test=' tjlx == "05" '>
			<![CDATA[
		        SELECT '今日' LXMC,COUNT(ID) TJ  FROM CUSTOMER  WHERE TO_DAYS(SH_DATE)=TO_DAYS(NOW())  AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '昨日' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE TO_DAYS( NOW( ) ) - TO_DAYS(SH_DATE) <= 1   AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '近7天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(SH_DATE)  AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '近30天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(SH_DATE)  AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '本月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_FORMAT(SH_DATE,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')  AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '上月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(SH_DATE,'%Y%m'))=1  AND SCBZ='0' AND STATE='1'
				UNION ALL
				SELECT '汇总' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE SCBZ='0' AND STATE='1'
		    ]]>
		</if>
		<if test=' tjlx == "06" '>
			<![CDATA[
		        SELECT '今日' LXMC,COUNT(ID) TJ  FROM CUSTOMER  WHERE TO_DAYS(ZSSJ)=TO_DAYS(NOW())  AND SCBZ='0'  AND ZSZT='1'
				UNION ALL
				SELECT '昨日' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE TO_DAYS( NOW( ) ) - TO_DAYS(ZSSJ) <= 1   AND SCBZ='0'  AND ZSZT='1'
				UNION ALL
				SELECT '近7天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= DATE(ZSSJ)  AND SCBZ='0' AND ZSZT='1'
				UNION ALL
				SELECT '近30天' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <=DATE(ZSSJ)  AND SCBZ='0'  AND ZSZT='1'
				UNION ALL
				SELECT '本月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE DATE_FORMAT(ZSSJ,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')  AND SCBZ='0'  AND ZSZT='1'
				UNION ALL
				SELECT '上月' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE  PERIOD_DIFF(DATE_FORMAT(CURDATE(),'%Y%m'),DATE_FORMAT(ZSSJ,'%Y%m'))=1  AND SCBZ='0'  AND ZSZT='1'
				UNION ALL
				SELECT '汇总' LXMC,COUNT(ID) TJ FROM CUSTOMER WHERE SCBZ='0'  AND ZSZT='1'
		    ]]>
		</if>
	</select>
</mapper>